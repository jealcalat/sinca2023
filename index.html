<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Descubrimiento de patrones en datos de movimiento usando modelos supervisados y no supervisados</title>
    <meta charset="utf-8" />
    <meta name="author" content="Emmanuel Alcalá" />
    <meta name="date" content="2023-11-16" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="libs/my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: center, title-slide, inverse-slide

&lt;style&gt;
.title-slide .remark-slide-number {
  display: none;
}

.title-slide h1 {
font-weight: bold;
font-size: 50px;
color: #282828;
}

.title-slide h2 {
font-weight: bold;
font-size: 40px;
color: #282828;
}

.subtitle-slide h1 {
  font-weight: bold;
  font-size: 40px;
}

.inverse-slide {
  background-color: #84a396;
  color: #020202;
}


.black-slide {
  background-color: #393533;
  color: #B58322;
}

&lt;/style&gt;

&lt;style&gt;
.remark-slide-content {
  font-size: 28px;
}

&lt;/style&gt;

&lt;style&gt;

.center2 {
  margin: -1%;
  position: absolute;
  top: 72%;
  left: 51%;
  width: 240px;
  height: 128px;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.logo {
  position: absolute;
  top: 1em;
  right: 1em;
  width: 110px;
  height: 128px;
  z-index: 0;
}

.my-one-page-font {
  font-size: 20px;
}

&lt;/style&gt;

&lt;style&gt;
blockquote {
    background-color: #afc0d5;
    /* font face italic */
    font-style: italic;
}
&lt;/style&gt;

&lt;style&gt;
div.footnotes {
  position: absolute;
  bottom: 0;
  margin-bottom: 10px;
  width: 80%;
  font-size: 0.6em;
}
&lt;/style&gt;

&lt;script&gt;
$(document).ready(function() {
  $('section:not(.backdrop):not(.title-slide)').append('&lt;div class=\"footnotes\"&gt;&lt;/div&gt;');

  // Use a regular expression to find and process your custom footnote syntax
  $('section').each(function() {
    var slide = $(this);
    var slideHtml = slide.html();

    slideHtml = slideHtml.replace(/\[\^(\d+)\]:\s*(.*?)\n/g, function(match, fnNum, text) {
      // Add the footnote text to the footnotes div
      var footnoteDiv = slide.find('div.footnotes');
      var existingFootnotes = footnoteDiv.html() || '';
      footnoteDiv.html(existingFootnotes + fnNum + '. ' + text + '&lt;br/&gt;');

      // Replace the footnote marker in the slide with a superscript number
      return '&lt;sup&gt;' + fnNum + '&lt;/sup&gt;';
    });

    slide.html(slideHtml);
  });
});
&lt;/script&gt;



# Discovering patterns in motion data using ~~supervised and~~ unsupervised models
# Emmanuel Alcalá
## CEIC, Universidad de Guadalajara

.center2[
&lt;img src="img/logo_ceic.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: middle

# The importance of measuring the spatial domain

--

Typically, experiments measure behavior subject to two constraints:

--

* a set of discrete responses predefined by the experimenter

--

* a particular experimental paradigm or tradition that dictates, more or less, what is important to measure

--

These two constraints, in turn, are restricted by the space of possibilities that technology allows.

---
class: middle

# The importance of measuring the spatial domain

The study of learning and behavior began in *space* (e.g., mazes, open field, etc).

--

With the invention of the operant conditioning chamber, the experimental study of behavior focused on time (interruptions of switches per unit of time, to be precise).

--

The limitations of not measuring the (3) spatial dimension of behavior have been recognized. For example, Davison (2018) describes an experiment by Alsop (1987) where pigeons were unable to discriminate between two magnetic fields. However, Mora et al (2004) achieved discrimination when they allowed pigeons to *walk*.

---
class: middle

&lt;blockquote&gt;
But behavior in the one dimension of time cannot properly and fully simulate behavior in time plus the additional 3 dimensions of space, because time is unidirectional and space is bidirectional. 
.right[-- &lt;cite&gt;Michael Davison, 2018&lt;/cite&gt;]
&lt;/blockquote&gt;

--

To the extent that behavior occurs in space and time, the importance of studying the spatial dynamics of behavior remains an empirical question.

---
class: middle

--

However, acknowledging it is not enough. Measuring behavior continuously in space increases the number of dimensions, which has long been a technical problem.

--

Here we illustrate a workflow that makes use of recent developments in ML that could help solve these problems.

--

We just explored a class of learning models called *unsupervised* models. These models are used to discover patterns in data without the need for a predefined labels.

---
class: middle

## Workflow

&lt;img src="img/diagrama_DLC.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: middle

## Data

Data comes from Campos-Ordonez et al (2022). The positional data of mice exposed to Cyclohexane and non-exposed mice was obtained using DeepLabCut (Mathis et al, 2018). Nine bodyparts were tracked: nose, left ear, right ear, neck, middle back, tail base, and three points along the tail.

&lt;img src="img/keypointing.png" width="50%" style="display: block; margin: auto;" /&gt;
---
class: middle

Example of reconstruction of a mouse's trajectory using estimated poses with DLC.

&lt;img src="img/T17_EXP_26_ABRIL_PM_tseconds.gif" width="70%" style="display: block; margin: auto;" /&gt;
&lt;!-- 
&lt;img src="img/T17_EXP_26_ABRIL_PM_tseconds.gif" width="70%" alt="Description"&gt; --&gt;

---
class: middle

## Feature engineering

Let `\(\boldsymbol{\gamma}_i(t)=(x_i(t), y_i(t))\)` for bodypart `\(i\)` at time `\(t\)`. The following features were obtaining from the positional data:

&lt;img src="img/features.png" width="60%" style="display: block; margin: auto;" /&gt;
---
class: middle

## Embedding using a variational autoencoder

--

A variational autoencoder (VAE) is a generative model that learns a latent space `\(\mathbf{Z}\)`, low-dimensional representation of the data that captures the most important features, from `\(\mathbf{X}\)`. 

--

The VAE is trained to reconstruct the data `\(\mathbf{\tilde{X}}\)` from the latent space, a probability distribution that is assumed to be a multivariate normal distribution.

&lt;img src="img/vae.png" width="60%" style="display: block; margin: auto;" /&gt;

---
class: middle

## Behavioral segmentation using a hidden Markov model

--

From the latent space (or directly with the features), we can use a hidden Markov model to segment the data into behavioral states. 

--

A hidden Markov model is a generative model that assumes that the data is generated by a Markov process with hidden states. The hidden states are not directly observable, but the data is. The hidden states are assumed to be a Markov process, i.e., the probability of being in a state at time `\(t\)` depends only on the state at time `\(t-1\)`.

---
class: middle

# Results

## HMM with kinematic features as input

We were able to segment the data in three states using the kinematic features as input to the HMM. Ordering the mean speed or acceleration features by states we can see three modes of locomotion: stop (with micromovements), slow, and fast. However, we were not able to identify some clear patterns like circling.

&lt;img src="img/Fig3.png" width="50%" style="display: block; margin: auto;" /&gt;
---
class: middle

## HMM with VAE latent space as input

Using the latent space of the VAE as input to the HMM, we were able to identify several states, two on which included circling

For visualization, because the latent space is still high-dimensional, we used UMAP to reduce the dimensionality to 2D.

UMAP is a non-linear dimensionality reduction algorithm that preserves the global and local structure of the data.

---
class: middle, black-slide

Left is UMAP embedding of the latent space of the VAE colored by state from HMM. A dot point is showing the state-space trajectory of a mouse. 

&lt;div style="display: flex;"&gt;
  &lt;div style="flex: 3;"&gt;
    &lt;video width="90%" height="90%" controls id="my_video"&gt;
      &lt;source src="img/umap_states_vame_first.mp4" type="video/mp4"&gt;
    &lt;/video&gt;
  &lt;/div&gt;
  &lt;div style="flex: 1; text-align: center;"&gt;
    &lt;p&gt;Minuto 2&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;div style="display: flex;"&gt;
  &lt;div style="flex: 3;"&gt;
    &lt;video width="90%" height="90%" controls id="my_video"&gt;
      &lt;source src="img/umap_states_vame_circling.mp4" type="video/mp4"&gt;
    &lt;/video&gt;
  &lt;/div&gt;
  &lt;div style="flex: 1; text-align: center;"&gt;
    &lt;p&gt;Minuto 17&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

---
class: middle

## What's next

--

* Exploring other models (LSTM, AR-HMM, etc).
* Fine tune the VAE.
* Validate the model and the states with trained observers.

---
class: middle

.center[
  # Gracias
.content-box[jealcalat@gmail.com]
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>

<script>
const options = {
  strings: [
    '<pre>nutriólogos</pre>', '<pre>psicólogos</pre>', '<pre>médicos</pre>', '<pre>físicos</pre>', '<pre>administradores</pre>', '<pre>contadores</pre>','<pre>médicos</pre>', '<pre>políticos</pre>', '<pre>ciudadanos</pre>'
  ],
  typeSpeed: 40,
  backSpeed: 20,
  cursorChar: '',
  loop: true
};

const typed = new Typed('.typed', options);
const typed2 = new Typed('.typed-eg', options);
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
